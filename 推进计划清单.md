# 推进计划清单



+ [x] 历史经验记录保存
+ [x] 指令轨迹信息保存
+ [x] 核心记忆管理模块迁移
+ [x] LLM服务模块封装
+ [x] 历史记忆参数适配
+ [x] 热启动/微冷启动流程设计

## 20251016 热启动功能基础能力已实现



+ [x] 微冷启动任务描述不准确

+ [ ] 微冷启动失败及回退处理

+ [x] 经验文件使用错误的 macro.json（应用UUID实现文件夹名唯一性，实现历史经验与轨迹对应）
+ [x]  轨迹事件序列化错误，热启动动作未正确记录到轨迹。
+ [x]  缺少微冷启动成功后的动作记录



## 20251029 整体性能优化

### 1. 架构和设计问题（重点）

+ [x] 

#### 1.1 配置管理混乱

- 问题: 存在多套配置系统（DroidRunConfig、MemoryConfig、环境变量）

- 影响: 配置分散，难以维护，容易出现不一致

- 位置:

- droidrun/config/manager.py - 主配置

- droidrun/agent/context/memory_config.py - 记忆配置

- main.py - 环境变量配置

+ [ ] 

#### 1.2 类职责过重

- 问题: DroidAgent 类承担了太多职责（1596行代码）

- 影响: 难以维护、测试和扩展

- 具体职责:

- 热启动/冷启动逻辑

- 微冷启动处理

- 经验管理

- 执行监控

- UI状态捕获

- 轨迹管理

+ [ ] 

#### 1.3 依赖关系复杂

- 问题: 各模块间耦合度高，循环依赖

- 影响: 难以独立测试和修改

- 示例: DroidAgent 直接依赖多个子模块

###  2. 性能问题（二级问题）

+ [ ] 

#### 2.1 LLM调用频繁

- 问题: 每个相似度计算都调用LLM

- 影响: 响应慢，成本高

- 位置: experience_memory.py 第86行

- 优化空间: 可以使用embedding模型或缓存

+ [ ] 
#### 2.2 同步等待过多

- 问题: 大量同步等待操作

- 影响: 整体执行效率低

- 示例:

- 经验保存等待 macro.json 生成

- UI状态获取和截图捕获

+ [ ] 
#### 2.3 内存使用不当

- 问题: 轨迹数据全量保存在内存中

- 影响: 长时间运行可能导致内存泄漏

- 位置: trajectory.py 和 droid_agent.py

###  3. 错误处理和稳定性问题（重点）

+ [x] 
#### 3.1 异常处理不统一

- 问题: 不同模块使用不同的异常处理策略

- 影响: 错误信息不一致，难以调试

- 示例:

- ExceptionConstants vs 标准异常

- 有些地方只记录警告，有些抛出异常

+ [x] 
#### 3.2 资源清理不完整

- 问题: 异步任务和资源没有正确清理

- 影响: 可能导致资源泄漏

- 位置: finalize 方法中的异步任务

+ [ ] 
#### 3.3 超时处理不完善

- 问题: 缺乏统一的超时处理机制

- 影响: 可能出现死锁或长时间等待

- 位置: LLM调用、设备操作等

### 4. 代码质量问题（三级问题）

+ [x] 
#### 4.1 硬编码值过多

- 问题: 虽然创建了常量文件，但仍有硬编码

- 影响: 难以调整和维护

- 示例: 魔法数字、字符串常量

+ [x] 
#### 4.2 日志记录不一致

- 问题: 日志级别和格式不统一

- 影响: 难以追踪和调试问题

- 位置: 各模块使用不同的日志格式

+ [x] 
#### 4.3 文档和注释不足

- 问题: 复杂逻辑缺乏详细注释

- 影响: 新开发者难以理解代码

- 位置: 热启动、微冷启动等核心逻辑

### 5. 功能完整性问题（三级问题）

+ [ ] 
#### 5.1 微冷启动失败处理

- 问题: 微冷启动失败后的回退机制不完善

- 影响: 用户体验差

- 位置: 推进计划清单.md 第18行提到

+ [ ] 
#### 5.2 经验质量评估

- 问题: 缺乏经验质量评估机制

- 影响: 可能使用低质量经验

- 位置: 经验选择和保存逻辑

+ [ ] 
#### 5.3 参数适配准确性

- 问题: 热启动参数适配可能不准确

- 影响: 执行失败率高

- 位置: llm_services.py 参数适配逻辑



## 20251030 需求新增/优化
+ [x] 高度相似的任务不再持久化经验信息
+ [ ] 将经验信息按照任务名分类进行二级检索降低总检索量（待定）